{{/*
  Optimized Image Shortcode
  Unterst√ºtzt sowohl Rastergrafiken als auch SVGs
*/}}
{{ $name := .Get "name" }}
{{ $width := .Get "width" }}
{{ $image := resources.Get (printf "img/%s" $name) }}

{{ if not $image }}
  {{ errorf "Bild nicht gefunden: %s" $name }}
{{ end }}

<figure{{ with .Get "class" }} class="{{ . }}"{{ end }}>
  {{ with .Get "link" }}<a href="{{ . }}" target="_blank" rel="noopener">{{ end }}

  {{ $isSVG := strings.HasSuffix $name ".svg" }}
  {{ if $isSVG }}
    <img src="{{ $image.RelPermalink }}"
         {{ with $width }}width="{{ . }}"{{ end }}
         alt="{{ .Get "alt" | default (path.BaseName $name) }}"
         loading="lazy">
  {{ else }}
    {{ $processed := $image.Resize (printf "%sx" $width) }}
    {{ $processed = $processed.Process "webp q85" }}
    <img src="{{ $processed.RelPermalink }}"
         alt="{{ .Get "alt" | default (path.BaseName $name) }}"
         width="{{ $width }}"
         loading="lazy">
  {{ end }}

  {{ with .Get "link" }}</a>{{ end }}
  {{ with .Get "caption" }}
    <figcaption style="font-size: 0.875rem; color: #666; margin-top: 0.5rem; font-style: italic;">{{ . | markdownify }}</figcaption>
  {{ end }}
</figure>
