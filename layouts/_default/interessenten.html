{{ define "main" }}
<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                {{ end }}
                {{ else }}
                <div class="alert alert-danger">
                    <i class="fa fa-exclamation-triangle"></i>
                    <strong>Fehler:</strong> CSV-Datei "{{ $csvFile }}" konnte nicht aus dem assets-Verzeichnis geladen werden.
                    <br><small>Hinweis: CSV-Dateien müssen im assets/ Verzeichnis liegen, nicht im data/ Verzeichnis.</small>
                </div>
                {{ end }}
                </div> <!-- End intern-content -->
            </article>
        </div>
    </div>
</div>
{{ end }}article role="main" class="blog-post">
                <!-- Geschützter Bereich Header -->
                <div class="protected-area intern-content" data-pagefind-ignore>
                    <div class="lock-icon">
                        <i class="fa fa-lock"></i>
                    </div>
                    <h1>{{ .Title }}</h1>
                    <p>Interner Organisationsbereich</p>
                </div>

                <div class="intern-content" data-pagefind-ignore>
                {{ .Content }}

                <!-- Download-Button für CSV-Datei -->
                <div class="csv-download-section" style="margin-bottom: 2rem;">
                    <a href="/intern/interessenten.csv" class="btn btn-success" download="interessenten.csv">
                        <i class="fa fa-download"></i> CSV-Datei herunterladen
                    </a>
                    <small class="text-muted d-block" style="margin-top: 0.5rem;">
                        Aktuelle Interessentenliste im CSV-Format (Semikolon-getrennt)
                    </small>
                </div>

                <!-- CSV-Tabelle aus assets/data/interessenten.csv -->
                {{ $csvData := slice }}
                {{ $csvFile := "data/interessenten.csv" }}
                {{ with resources.Get $csvFile }}
                    {{ $opts := dict "delimiter" ";" "targetType" "slice" }}
                    {{ $csvData = transform.Unmarshal $opts . }}
                {{ else }}
                    {{ warnf "CSV-Datei %s nicht gefunden in assets/" $csvFile }}
                {{ end }}

                {{ if $csvData }}
                <div class="members-table table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                {{ range index $csvData 0 }}
                                    <th scope="col">{{ . }}</th>
                                {{ end }}
                            </tr>
                        </thead>
                        <tbody>
                            {{ range $index, $row := $csvData }}
                                {{ if ne $index 0 }}
                                <tr>
                                    {{ range $cellIndex, $cell := $row }}
                                        {{ if eq $cellIndex 1 }}
                                            <!-- Email-Spalte mit Link -->
                                            <td>
                                                {{ if $cell }}
                                                    <a href="mailto:{{ $cell }}" class="email-link">
                                                        <i class="fa fa-envelope"></i> {{ $cell }}
                                                    </a>
                                                {{ else }}
                                                    <span class="text-muted">Keine E-Mail</span>
                                                {{ end }}
                                            </td>
                                        {{ else if eq $cellIndex 6 }}
                                            <!-- Telefon-Spalte mit Link -->
                                            <td>
                                                {{ if $cell }}
                                                    <a href="tel:{{ $cell }}" class="phone-link">
                                                        <i class="fa fa-phone"></i> {{ $cell }}
                                                    </a>
                                                {{ else }}
                                                    <span class="text-muted">Kein Telefon</span>
                                                {{ end }}
                                            </td>
                                        {{ else if eq $cellIndex 8 }}
                                            <!-- Homepage-Nennung mit Icon -->
                                            <td>
                                                {{ if eq $cell "Ja" }}
                                                    <span class="badge bg-success">
                                                        <i class="fa fa-check"></i> {{ $cell }}
                                                    </span>
                                                {{ else }}
                                                    <span class="badge bg-secondary">
                                                        <i class="fa fa-times"></i> {{ $cell }}
                                                    </span>
                                                {{ end }}
                                            </td>
                                        {{ else }}
                                            <td>{{ $cell }}</td>
                                        {{ end }}
                                    {{ end }}
                                </tr>
                                {{ end }}
                            {{ end }}
                        </tbody>
                    </table>
                </div>

                <!-- Zusammenfassung mit korrekten CSV-Daten -->
                {{ $totalInteressenten := sub (len $csvData) 1 }}
                {{ $mitEmail := 0 }}
                {{ $mitTelefon := 0 }}
                {{ $mitHomepage := 0 }}
                {{ range $index, $row := $csvData }}
                    {{ if ne $index 0 }}
                        {{ if index $row 1 }}{{ $mitEmail = add $mitEmail 1 }}{{ end }}
                        {{ if index $row 6 }}{{ $mitTelefon = add $mitTelefon 1 }}{{ end }}
                        {{ if eq (index $row 8) "Ja" }}{{ $mitHomepage = add $mitHomepage 1 }}{{ end }}
                    {{ end }}
                {{ end }}

                <div class="row" style="margin-top: 2rem;">
                    <div class="col-md-3">
                        <div class="alert alert-info">
                            <strong><i class="fa fa-users"></i> Interessenten:</strong> {{ $totalInteressenten }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="alert alert-success">
                            <strong><i class="fa fa-envelope"></i> Mit E-Mail:</strong> {{ $mitEmail }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="alert alert-warning">
                            <strong><i class="fa fa-phone"></i> Mit Telefon:</strong> {{ $mitTelefon }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="alert alert-primary">
                            <strong><i class="fa fa-globe"></i> Homepage OK:</strong> {{ $mitHomepage }}
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fa fa-info-circle"></i>
                    <strong>Datenschutz:</strong> Diese Daten sind vertraulich und nur für Organisatoren bestimmt.
                    Weitergabe an Dritte ist nicht gestattet.
                    <br><small>Stand: {{ now.Format "02.01.2006 15:04" }} Uhr | Daten aus assets/data/interessenten.csv</small>
                </div>
                {{ else }}
                <div class="alert alert-danger">
                    <i class="fa fa-exclamation-triangle"></i>
                    <strong>Fehler:</strong> CSV-Datei "{{ $csvFile }}" konnte nicht aus dem assets-Verzeichnis geladen werden.
                    <br><small>Hinweis: CSV-Dateien müssen im assets/ Verzeichnis liegen, nicht im data/ Verzeichnis.</small>
                </div>
                {{ end }}
            </article>
        </div>
    </div>
</div>
{{ end }}
